<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Test Page</title>
    <link rel="stylesheet" href="style.css">

    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
            j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-KD7B66SJ');
    </script>
    <!-- End Google Tag Manager -->
</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KD7B66SJ" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h1>GTM Test Page</h1>
    <p>Check Google Tag Manager in Preview Mode.</p>

    <button id="confirmBtn" class="green-button">Confirm</button>
    <button class="green-button" onclick="showPopup()">Click Me</button>

    <!-- Form (Initially Hidden) -->
    <form id="testForm" style="display:none; margin-top: 20px;">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <br><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br><br>
        <button type="submit" class="Confirm_submit">Submit</button>
    </form>

    <div class="popup" id="detailsPopup" style="display:none;"></div>
    <div class="overlay" id="overlay" style="display:none;"></div>

    <video id="myVideo" controls height="350">
        <source src="SampleVideo_1280x720_5mb.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <script>
        window.dataLayer = window.dataLayer || [];

        // A/B Test Logic
        function assignVariation() {
            let storedVariation = localStorage.getItem('abTestVariation');
            if (!storedVariation) {
                storedVariation = Math.random() < 0.5 ? '0' : '1';
                localStorage.setItem('abTestVariation', storedVariation);
            }
            return storedVariation;
        }

        const variation = assignVariation(); // Store globally

        function showPopup() {
            renderPopup();
            document.getElementById("overlay").style.display = "block";
        }

        function closePopup() {
            document.getElementById("detailsPopup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        function renderPopup() {
            let popup = document.getElementById('detailsPopup');
            popup.style.display = 'block';
            popup.innerHTML = `
                <label for="college">College Name:</label>
                <input type="text" id="college" name="college">
                <label for="qualification">Highest Qualification:</label>
                <input type="text" id="qualification" name="qualification">
                ${variation === '1' ? `
                    <div class="accept-terms">
                        <input type="checkbox" id="acceptTerms" name="acceptTerms">
                        <label for="acceptTerms">We accept</label>
                    </div>
                ` : ''}
                <button onclick="closePopup()" class="Click_me_submit">Submit</button>
            `;

            if (variation === '1') {
                document.getElementById("acceptTerms").addEventListener("change", function() {
                    if (localStorage.getItem('gemhonoringTracked') !== '1') {
                        window.dataLayer.push({
                            'event': 'gemhonoring',
                            'checkbox_checked': this.checked ? 1 : 0
                        });
                        localStorage.setItem('gemhonoringTracked', '1');
                    }
                });
            }
        }

        // Confirm Button Click Tracking
        document.getElementById("confirmBtn").addEventListener("click", function() {
            document.getElementById("testForm").style.display = "block";
            window.dataLayer.push({'event': 'confirm_button_clicked'});
        });

        // Form Submission Tracking
        document.getElementById("testForm").addEventListener("submit", function(event) {
            event.preventDefault();
            window.dataLayer.push({
                'event': 'form_submitted',
                'form_data': {
                    'name': document.getElementById("name").value,
                    'email': document.getElementById("email").value
                }
            });
            alert("Form Submitted! Check GTM Data Layer.");
        });

        // Page View Tracking
        window.dataLayer.push({
            'event': 'page_view',
            'page_title': document.title
        });

        // Video Event Tracking
        document.addEventListener('DOMContentLoaded', function() {
            var video = document.getElementById('myVideo');
            if (video) {
                video.addEventListener('play', function() {
                    dataLayer.push({'event': 'Sample Video', 
                                    'videoStatus': 'play', 
                                    'videoUrl': video.currentSrc, 
                                    'videoTitle': 'Sample Video'});
                });
                video.addEventListener('pause', function() {
                    dataLayer.push({'event': 'Sample Video', 
                                    'videoStatus': 'pause', 
                                    'videoUrl': video.currentSrc, 
                                    'videoTitle': 'Sample Video'});
                });
                video.addEventListener('ended', function() {
                    dataLayer.push({'event': 'Sample Video', 
                                    'videoStatus': 'ended', 
                                    'videoUrl': video.currentSrc, 
                                    'videoTitle': 'Sample Video'});
                });

                video.addEventListener('timeupdate', function(){
                    var progress = (video.currentTime / video.duration) * 100;
                    if(progress > 25 && progress < 26){
                        dataLayer.push({'event': 'Sample Video', 
                                        'videoStatus': '25%', 
                                        'videoUrl': video.currentSrc, 
                                        'videoTitle': 'Sample Video'});
                    }
                    if(progress > 50 && progress < 51){
                        dataLayer.push({'event': 'Sample Video', 
                                        'videoStatus': '50%', 
                                        'videoUrl': video.currentSrc, 
                                        'videoTitle': 'Sample Video'});
                    }
                    if(progress > 75 && progress < 76){
                        dataLayer.push({'event': 'Sample Video', 
                                        'videoStatus': '75%', 
                                        'videoUrl': video.currentSrc, 
                                        'videoTitle': 'Sample Video'});
                    }
                });
            }
        });

    </script>
</body>
</html>
