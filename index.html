<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM Test Page</title>
    <link rel="stylesheet" href="style.css">

    <!-- Google Tag Manager -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0], j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
            j.async=true; j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-KD7B66SJ');
    </script>
    <!-- End Google Tag Manager -->
</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KD7B66SJ" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h1>GTM Test Page</h1>
    <p>Check Google Tag Manager in Preview Mode.</p>

    <button id="confirmBtn" class="green-button">Confirm</button>
    <button class="green-button" onclick="showPopup()">Click Me</button>

    <br><br>

    <!-- Form (Initially Hidden) -->
    <form id="testForm" style="display:none; margin-top: 20px;">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <br><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br><br>
        <button type="submit" id="main-form_submit" class="Confirm_submit">Submit</button>
    </form>

    <div class="popup" id="detailsPopup"></div>
    <div class="overlay" id="overlay"></div>

       <br>
    
    <video id="myVideo" controls height="350">
        <source src="SampleVideo_1280x720_5mb.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

     <div class="songs-wrapper">
        <div class="song-container">
        
        <a href = "song1.html" target="_blank" id="song" class="first_song"><h2>There's Nothing holding me back</h2></a>
        <pre>
I wanna follow where she goes
I think about her and she knows it
I wanna let her take control
'Cause every time that she gets close, yeah
She pulls me in enough to keep me guessin', hm
And maybe I should stop and start confessin'
Confessin', yeah
Oh, I've been shakin', I love it when you go crazy
You take all my inhibitions
Baby, there's nothing holdin' me back
You take me places that tear up my reputation
Manipulate my decisions
Baby, there's nothing holdin' me back
There's nothing holdin' me back
There's nothing holdin' me back
She says that she's never afraid
Just picture everybody naked
She really doesn't like to wait
Not really into hesitation
Pulls me in enough to keep me guessin', whoa
And maybe I should stop and start confessin'
Confessin', yeah
Oh, I've been shakin', I love it when you go crazy
You take all my inhibitions
Baby, there's nothing holdin' me back
You take me places that tear up my reputation
Manipulate my decisions
Baby, there's nothing holdin' me back
There's nothing holdin' me back
'Cause if we lost our minds and we took it way too far
I know we'd be alright, I know we would be alright
If you were by my side and we stumbled in the dark
I know we'd be alright, I know we would be alright
'Cause if we lost our minds and we took it way too far
I know we'd be alright, I know we would be alright
If you were by my side and we stumbled in the dark
I know we'd be alright, we would be alright
Oh, I've been shakin', I love it when you go crazy
You take all my inhibitions
Baby, there's nothing holdin' me back
You take me places that tear up my reputation
Manipulate my decisions
Baby, there's nothing holdin' me back, oh-whoa
There's nothing holdin' me back
I feel so free when you're with me, baby
Baby, there's nothing holdin' me back
        </pre>
      </div>
      
      
      <div class="song-container vertical-line">
        <a href="song2.html" target="_blank" id="song" class="second_song"><h2>Night We Met</h2></a>
        <pre>
I am not the only traveler
Who has not repaid his debt
I've been searching for a trail to follow again
Take me back to the night we met
And then I can tell myself
What the hell I'm supposed to do
And then I can tell myself
Not to ride along with you
I had all and then most of you
Some and now none of you
Take me back to the night we met
I don't know what I'm supposed to do
Haunted by the ghost of you
Oh, take me back to the night we met
When the night was full of terrors
And your eyes were filled with tears
When you had not touched me yet
Oh, take me back to the night we met
I had all and then most of you
Some and now none of you
Take me back to the night we met
I don't know what I'm supposed to do
Haunted by the ghost of you
Take me back to the night we met
        </pre>
      </div>
    </div>

    <script>

        function getOrCreateUniqueId() {
    let uniqueId = getCookie("uniqueUserId");

    if (!uniqueId) {
        // Generate a UUID (Universally Unique Identifier)
        uniqueId = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
        setCookie("uniqueUserId", uniqueId, 365); // Set cookie for 365 days
    }
    return uniqueId;
}

function setCookie(name, value, days) {
    let expires = "";
    if (days) {
        let date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}

function getCookie(name) {
    let nameEQ = name + "=";
    let ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

// Get the unique ID
let userId = getOrCreateUniqueId();
console.log("Unique User ID:", userId);

// You can now use the 'userId' variable for tracking purposes

        
        
        window.dataLayer = window.dataLayer || [];

        // A/B Test Logic
       // A/B Test Logic (Moved outside DOMContentLoaded)
    function assignVariation() {
        let storedVariation = getCookie('abTestVariation');
        if (!storedVariation) {
            storedVariation = Math.random() < 0.5 ? '0' : '1';
            setCookie('abTestVariation', storedVariation, 30);
        }
        return storedVariation;
    }

        const variation = assignVariation(); // Store globally

 function showPopup() {
        let popup = document.getElementById("detailsPopup");
        let overlay = document.getElementById("overlay");

        popup.innerHTML = `
            <label for="college">College Name:</label>
            <input type="text" id="college" name="college" required>
            <br><br>
            <label for="qualification">Highest Qualification:</label>
            <input type="text" id="qualification" name="qualification" required>
            <br><br>
            <div class="accept-terms flex-row">
                <input type="checkbox" id="acceptTerms" name="acceptTerms">
                <label for="acceptTerms">We accept</label>
            </div>
            <br>
            <button id="popupFormSubmit" class="Click_me_submit">Submit</button>
        `;

        // Show popup
        popup.style.display = "block";
        overlay.style.display = "block";

        // Fire GTM event when popup appears
        window.dataLayer.push({
            'event': 'Term_shown',
            'term_shown': 1
        });

     // Fire GTM event for initial checkbox status
    window.dataLayer.push({
        'event': 'checkbox_initial_status',
        'checkbox_status': document.getElementById("acceptTerms").checked ? 1 : 0
    });

// Listen for checkbox change inside the popup
        document.getElementById("acceptTerms").addEventListener("change", function() {
            window.dataLayer.push({
                'event': 'checkbox_tick', // Changed event name for consistency
                'checkbox_status': this.checked ? 1 : 0 // Changed variable name
            });
        });

        // Listen for submit button click inside the popup
        document.getElementById("popupFormSubmit").addEventListener("click", function() { // Corrected line
            const collegeInput = document.getElementById("college");
            const qualificationInput = document.getElementById("qualification");

            if (!collegeInput.value || !qualificationInput.value) {
                alert("Please fill in all required fields.");
                return;
            }

            window.dataLayer.push({
                'event': 'ClickMe_Submit',
                'button_class': 'Click_me_submit'
            });
            closePopup();
        });

        // Function to close popup
        function closePopup() {
            document.getElementById("detailsPopup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        // Confirm Button Click Event
        document.getElementById("confirmBtn").addEventListener("click", function() {
            document.getElementById("testForm").style.display = "block";
            window.dataLayer.push({'event': 'confirm_button_clicked'});
        });

        // Form Submission
        document.getElementById("testForm").addEventListener("submit", function(event) {
            if (!this.checkValidity()) {
                event.preventDefault();
                this.reportValidity();
            } else {
                event.preventDefault();
                window.dataLayer.push({
                    'event': 'Confirm-Submit',
                    'form_data': {
                        'name': document.getElementById("name").value,
                        'email': document.getElementById("email").value
                    }
                });
                alert("Form Submitted! Check GTM Data Layer.");
            }
        });
        
        // Click Me Button Event
        document.querySelectorAll(".green-button")[1].addEventListener("click", showPopup);

        document.addEventListener("DOMContentLoaded", function() {
        // ... (Your DOMContentLoaded event listener) ...
        // Page View Tracking
        window.dataLayer.push({
            'event': 'page_view',
            'page_title': document.title,
    });        
    });
        
        // Video Event Tracking
        var video = document.getElementById('myVideo');
        if (video) {
            video.addEventListener('play', function() {
                dataLayer.push({'event': 'Sample Video',
                    'videoStatus': 'play',
                    'videoUrl': video.currentSrc,
                    'videoTitle': 'Sample Video'});
            });
            video.addEventListener('pause', function() {
                dataLayer.push({'event': 'Sample Video',
                    'videoStatus': 'pause',
                    'videoUrl': video.currentSrc,
                    'videoTitle': 'Sample Video'});
            });
            video.addEventListener('ended', function() {
                dataLayer.push({'event': 'Sample Video',
                    'videoStatus': 'ended',
                    'videoUrl': video.currentSrc,
                    'videoTitle': 'Sample Video'});
            });

            video.addEventListener('timeupdate', function(){
                var progress = (video.currentTime / video.duration) * 100;
                if(progress > 25 && progress < 26){
                    dataLayer.push({'event': 'Sample Video',
                        'videoStatus': '25%',
                        'videoUrl': video.currentSrc,
                        'videoTitle': 'Sample Video'});
                }
                if(progress > 50 && progress < 51){
                    dataLayer.push({'event': 'Sample Video',
                        'videoStatus': '50%',
                        'videoUrl': video.currentSrc,
                        'videoTitle': 'Sample Video'});
                }
                if(progress > 75 && progress < 76){
                    dataLayer.push({'event': 'Sample Video',
                        'videoStatus': '75%',
                        'videoUrl': video.currentSrc,
                        'videoTitle': 'Sample Video'});
                }
            });
        }
    });
</script>
</body>
</html>
